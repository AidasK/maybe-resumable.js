<!DOCTYPE html>
<html>
<head>
    <title></title>
    <script>var module = {};</script>
    <script src="../bower_components/resumable.js/resumable.js"></script>
    <script src="../src/maybe-resumable.js"></script>
    <script src="../src/not-resumable.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.1/jquery.min.js"></script>
    <style>
        .list {
            list-style: none;
            border-top: 2px solid black;
            padding: 0;
        }
        .list li span{
            display: block;
        }
        .list li a{
            padding: 5px;
            color: blue;
        }
        .list li {
            border-bottom: 2px solid black;
            word-wrap: break-word;
            word-break: break-all;
            overflow: hidden;
        }
        .span6 {
            width: 50%;
             float: left;
        }
    </style>
</head>
<body>
<div class="span6">
    <input id="resumableUploader" type="file">
    <a href="#" onclick="resume.upload()">Upload</a>
    <a href="#" onclick="resume.pause()">Pause</a>
    <a href="#" onclick="resume.cancel()">Cancel</a>
    <ul id="resumableList" class="list">

    </ul>
</div>

<div class="span6">
    <input id="notResumableUploader" type="file">
    <a href="#" onclick="noresume.upload()">Upload</a>
    <a href="#" onclick="noresume.pause()">Pause</a>
    <a href="#" onclick="noresume.cancel()">Cancel</a>
    <ul id="notResumableList" class="list">

    </ul>
</div>

<script>
function init(resumable) {
    var opts = {
        target: 'server.php',
        query: {'Hello':'hi', 'resumable': resumable},
        simultaneousUploads: 1
    };
    var r = resumable ? new Resumable(opts) : new NotResumable(opts);
    if (!r.support) {
        return ;
    }
    r.assignBrowse(document.getElementById(resumable ? 'resumableUploader' : 'notResumableUploader'));
    r.on('catchall', function () {
        console.log(arguments[0], arguments);
    });
    r.on('fileSuccess', function(file, message){
        list.update(file, message);
    });
    r.on('fileProgress', function(file){
        list.update(file);
    });
    r.on('fileAdded', function(file, event){
        list.add(file);
    });
    r.on('filesAdded', function(array){

    });
    r.on('fileRetry', function(file){
        list.update(file);
    });
    r.on('fileError', function(file, message){
        list.update(file, 'Error: ' + message);
    });
    r.on('uploadStart', function(){

    });
    r.on('complete', function(){

    });
    r.on('progress', function(){

    });
    r.on('error', function(message, file){

    });
    r.on('pause', function(){

    });
    r.on('cancel', function(){

    });

    function ResumableList(element) {
        var $ = this;
        $.element = element;
        $.files = {};
        $.init = function () {

        };
        $.add = function (file) {
            var element = document.createElement('li');
            $.element.appendChild(element);
            $.files[file.uniqueIdentifier] = new ResumableListRow(element, file);
        };
        $.update = function (file, message) {
            $.files[file.uniqueIdentifier] && $.files[file.uniqueIdentifier].update(file, message);
        };
        $.init();
    }
    function ResumableListRow(element, file) {
        var $ = this;
        $.element = element;
        $.file = file;
        $.message = '';
        $.init = function () {
            var element;
            for (var index in {'fileName':1, 'size':1, 'relativePath':1, 'uniqueIdentifier':1}) {
                element = document.createElement('span');
                element.innerText = index + ': ' + $.file[index];
                $.element.appendChild(element);
            }
            element = document.createElement('span');
            element.innerText = 'progress: ' + $.file.progress();
            $.element.appendChild(element);

            element = document.createElement('span');
            element.innerText = 'message: ' + $.message;
            $.element.appendChild(element);

            jQuery.each({'abort':1, 'retry':1, 'cancel':1}, function (index) {
                element = document.createElement('a');
                element.innerText = index;
                element.href = "#";
                jQuery(element).bind('click', function () {
                    $.file[index]();
                    if (index == 'cancel') {
                        jQuery($.element).remove();
                    }
                    return false;
                });
                $.element.appendChild(element);
            });
        };
        $.update = function (file, message) {
            $.file = file;
            $.element.innerHTML = '';
            $.message = message;
            $.init();
        };
        $.init();
    }

    var element = document.getElementById(resumable ? 'resumableList' : 'notResumableList');
    var list = new ResumableList(element);
    return r;
}
var resume = init(true);
var noresume = init(false);
</script>
</body>
</html>