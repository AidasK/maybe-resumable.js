/*! resumable.js 2013-07-30 */
"use strict";var MaybeResumable=function(a){var b=new Resumable(a);return b.support?b:new NotResumable(a)};"undefined"!=typeof module&&(module.exports=MaybeResumable);var NotResumable=function(opts){function NotResumableFile(a,b){function c(){var a=/MSIE (6|7|8)/.test(navigator.userAgent)?document.createElement('<iframe name="'+g.uniqueIdentifier+"_iframe"+'">'):document.createElement("iframe");return a.setAttribute("id",g.uniqueIdentifier+"_iframe_id"),a.setAttribute("name",g.uniqueIdentifier+"_iframe"),a.style.display="none",document.body.appendChild(a),a}function d(){var a=g.getOpt(["target"]),b=document.createElement("form");return b.encoding="multipart/form-data",b.method="POST",b.setAttribute("action",a.target),g.iFrame||(g.iFrame=c()),b.setAttribute("target",g.iFrame.name),b.style.display="none",document.body.appendChild(b),b}function e(a,b){var c;$h.each(b,function(b,d){d&&1===d.nodeType?c=d:(c=document.createElement("input"),c.setAttribute("value",d)),c.setAttribute("name",b),a.appendChild(c)})}function f(){if(g.iFrame&&g.iFrame.parentNode){try{if(g.iFrame.contentDocument&&g.iFrame.contentDocument.body&&"false"==g.iFrame.contentDocument.body.innerHTML)return}catch(a){i=!0,g.resumableObj.fire("fileError",g,a)}var b=g.iFrame.contentDocument||g.iFrame.contentWindow.document,c=b.body.innerHTML;g.abort(),h=!0,g.resumableObj.fire("fileSuccess",g,c),g.resumableObj.upload()}}var g=this;g.opts={},g.getOpt=a.getOpt,g.resumableObj=a,g.element=b,g.fileName=b.value&&b.value.replace(/.*(\/|\\)/,""),g.size=null,g.relativePath=g.fileName,g.uniqueIdentifier=$h.generateUniqueIdentifier(b),g.iFrame=null;var h=!1,i=!1;return g.abort=function(){g.iFrame&&(g.iFrame.setAttribute("src","java"+String.fromCharCode(115)+"cript:false;"),$h.removeElement(g.iFrame),g.iFrame=null),g.resumableObj.fire("fileProgress",g)},g.cancel=function(){g.abort(),g.resumableObj.removeFile(g),g.resumableObj.fire("fileProgress",g)},g.retry=function(){g.bootstrap(),g.resumableObj.upload()},g.bootstrap=function(){g.abort(),i=!1},g.progress=function(){return i?1:h?1:0},g.isUploading=function(){return null!==g.iFrame},g.sizeUploaded=function(){return null},g.timeRemaining=function(){return null},g.send=function(){if(!h){var a=g.getOpt(["query","fileParameterName","paramNames"]),b=d(),c=a.query;$h.isFunction(c)&&(c=c(g)),c[a.fileParameterName]=g.element,c[a.paramNames.resumableFilename]=g.fileName,c[a.paramNames.resumableRelativePath]=g.relativePath,c[a.paramNames.resumableIdentifier]=g.uniqueIdentifier,e(b,c),g.resumableObj.fire("fileProgress",g),$h.addEvent(g.iFrame,"load",f),b.submit(),$h.removeElement(b)}},g.bootstrap(),this}if(!(this instanceof NotResumable))return new NotResumable(opts);this.support=!1;var $=this;$.files=[],$.defaults={simultaneousUploads:3,fileParameterName:"file",paramNames:{resumableFilename:"resumableFilename",resumableRelativePath:"resumableRelativePath",resumableIdentifier:"resumableIdentifier"},query:{},target:"/",generateUniqueIdentifier:null},$.opts=opts||{},$.getOpt=function(a){var b=this;if(a instanceof Array){var c={};return $h.each(a,function(a){c[a]=b.getOpt(a)}),c}if(b instanceof NotResumableFile){if("undefined"!=typeof b.opts[a])return b.opts[a];b=b.resumableObj}return b instanceof NotResumable?"undefined"!=typeof b.opts[a]?b.opts[a]:b.defaults[a]:void 0},$.events=[],$.on=function(a,b){$.events.push(a.toLowerCase(),b)},$.fire=function(){for(var a=[],b=0;b<arguments.length;b++)a.push(arguments[b]);for(var c=a[0].toLowerCase(),b=0;b<=$.events.length;b+=2)$.events[b]==c&&$.events[b+1].apply($,a.slice(1)),"catchall"==$.events[b]&&$.events[b+1].apply(null,a);"fileerror"==c&&$.fire("error",a[2],a[1]),"fileprogress"==c&&$.fire("progress")};var $h={stopEvent:function(a){a.stopPropagation(),a.preventDefault()},each:function(a,b){if(a&&"undefined"!=typeof a.length){for(var c=0;c<a.length;c++)if(b(a[c])===!1)return}else for(c in a)if(b(c,a[c])===!1)return},generateUniqueIdentifier:function(a){var b=$.getOpt("generateUniqueIdentifier");return"function"==typeof b?b(a):"xxxxxxxx-xxxx-yxxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(a){var b=0|16*Math.random(),c="x"==a?b:8|3&b;return c.toString(16)})},addEvent:function(a,b,c){a.addEventListener?a.addEventListener(b,c,!1):a.attachEvent?a.attachEvent("on"+b,c):a["on"+b]=c},removeEvent:function(a,b,c){a.removeEventListener?a.removeEventListener(b,c,!1):a.detachEvent?a.detachEvent("on"+b,c):a["on"+b]=null},removeElement:function(a){a.parentNode.removeChild(a)},parseJson:function(json){return window.JSON?JSON.parse(json):eval("("+json+")")},isFunction:function(a){var b={};return a&&"[object Function]"===b.toString.call(a)}},appendFilesFromDomElements=function(a,b){var c=0,d=$.getOpt(["maxFiles","maxFilesErrorCallback"]);if("undefined"!=typeof d.maxFiles&&d.maxFiles<a.length+$.files.length){if(1!==d.maxFiles||1!==$.files.length||1!==a.length)return d.maxFilesErrorCallback(a,c++),!1;$.removeFile($.files[0])}var e=[];$h.each(a,function(a){if(a.value){var c=new NotResumableFile($,a);$.files.push(c),e.push(c),$.fire("fileAdded",c,b)}}),$.fire("filesAdded",e)},inputChangeEvent=function(a){var b=a.srcElement;$h.removeEvent(b,"change",inputChangeEvent),$.addFile(b,a);var c=b.cloneNode();b.parentNode.replaceChild(c,b),c.value="",$h.addEvent(c,"change",inputChangeEvent)};return $.assignBrowse=function(a){"undefined"==typeof a.length&&(a=[a]),$h.each(a,function(a){var b;"INPUT"===a.tagName&&"file"===a.type?b=a:(b=document.createElement("input"),b.setAttribute("type","file"),a.style.display="inline-block",a.style.position="relative",b.style.position="absolute",b.style.top=b.style.left=b.style.bottom=b.style.right=0,b.style.opacity=0,b.style.cursor="pointer",a.appendChild(b)),$h.addEvent(b,"change",inputChangeEvent)})},$.assignDrop=function(){},$.unAssignDrop=function(){},$.isUploading=function(){var a=!1;return $h.each($.files,function(b){return b.isUploading()?(a=!0,!1):void 0}),a},$.upload=function(){var a=0;$h.each($.files,function(b){if(1!=b.progress()){if(b.isUploading())return a++,void 0;if(a++>=$.getOpt("simultaneousUploads"))return!1;1==a&&$.fire("uploadStart"),b.send()}}),a||$.fire("complete")},$.pause=function(){$h.each($.files,function(a){a.abort()}),$.fire("pause")},$.cancel=function(){for(var a=$.files.length-1;a>=0;a--)$.files[a].cancel();$.fire("cancel")},$.progress=function(){var a=0,b=0;return $h.each($.files,function(c){a+=c.progress(),b++}),totalSize>0?a/b:0},$.addFile=function(a,b){1===a.nodeType&&appendFilesFromDomElements([a],b)},$.removeFile=function(a){for(var b=$.files.length-1;b>=0;b--)$.files[b]===a&&$.files.splice(b,1)},$.getFromUniqueIdentifier=function(a){var b=!1;return $h.each($.files,function(c){c.uniqueIdentifier==a&&(b=c)}),b},$.getSize=function(){return null},this};"undefined"!=typeof module&&(module.exports=NotResumable);